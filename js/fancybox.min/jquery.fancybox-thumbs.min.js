/*!
 * Thumbnail helper for fancyBox
 * version: 2.0.0 (Tue, 29 Jan 2013)
 * @requires fancyBox v3.0 or later
 *
 * Usage:
 *     $(".fancybox").fancybox({
 *         helpers : {
 *             thumbs: {
 *                 width  : 50,
 *                 height : 50
 *             }
 *         }
 *     });
 *
 */
(function(b){var a=b.fancybox;a.helpers.thumbs={defaults:{width:75,height:50,position:"bottom",source:function(){}},list:null,items:null,count:0,_create:function(e){var c=this.opts,f,d;f="";b.each(e.group,function(g){f+='<li><a data-index="'+g+'" href="javascript:jQuery.fancybox.jumpto('+g+');"></a></li>'});this.list=d=b("<ul>"+f+"</ul>");this.items=d.children();this.count=this.items.length;this.wrap=b('<div id="fancybox-thumbs" class="'+c.position+'"></div>').append(d).wrapInner('<div class="inner" />').wrapInner('<div class="outer" />').appendTo("body");b('<a class="fancybox-thumb-prev" href="javascript:;"><span></span></a>').click(b.proxy(this.prev,this)).prependTo(this.wrap);b('<a class="fancybox-thumb-next" href="javascript:;"><span></span></a>').click(b.proxy(this.next,this)).appendTo(this.wrap);d.find("a").width(c.width).height(c.height);this.width=this.items.outerWidth(true);this.height=this.items.outerHeight(true);d.width(this.width*this.count).height(this.height)},_loadPage:function(){var e=this,d,c,f;var g=function(h){e._setThumb(d,h)};if(!this.list){return}d=this.list.find("a").slice(this.start,this.end+1).not(".ready").first();if(d&&d.length){d.addClass("ready");c=a.group[d.data("index")];href=this._getThumb(c,g);if(b.type(href)==="string"){g(href)}else{if(!href){this._loadPage()}}}},_getThumb:function(e,g){var d=this,c,f;c=this.opts.source(e,g);if(!c&&e.element){c=b(e.element).find("img").attr("src")}if(!c&&(f=e.href.match(/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*)).*/i))){c="http://img.youtube.com/vi/"+f[3]+"/mqdefault.jpg"}if(!c&&(f=e.href.match(/(?:vimeo(?:pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/))){b.getJSON("http://www.vimeo.com/api/v2/video/"+f[1]+".json?callback=?",{format:"json"},function(h){g(h[0].thumbnail_small)});return true}if(!c&&e.type==="image"&&e.href){c=e.href}return c},_setThumb:function(e,f){var d=this;var c=function(){d._loadPage()};if(!this.list){return}b("<img />").load(function(){var k=this.width,g=this.height,j=e.width(),l=e.height(),i,h;if(!d.wrap||!k||!g){c();return}i=k/j;h=g/l;if(i>=1&&h>=1){if(i>h){k=k/h;g=l}else{k=j;g=g/i}}b(this).css({width:Math.floor(k),height:Math.floor(g),"margin-top":Math.floor(l*0.3-g*0.3),"margin-left":Math.floor(j*0.5-k*0.5)}).appendTo(e);c()}).error(c).attr("src",f)},_move:function(f){var g=0,e=400,c,h,d;if(!this.wrap){return}c=Math.ceil(this.count/this.itemsMin);if(f===undefined){f=Math.floor(a.current.index/this.itemsMin)+1}b(".fancybox-thumb-prev, .fancybox-thumb-next").hide();if(c<2){b.extend(this,{pages:c,page:1,start:0,end:this.count});this.list.stop(true).css({"margin-left":"auto","margin-right":"auto",left:0});this._loadPage();return}if(f<=1){f=1}else{b(".fancybox-thumb-prev").show()}if(f>=c){f=c}else{b(".fancybox-thumb-next").show()}h=(f-1)*this.itemsMin;d=(h+this.itemsMax)-1;g=(this.width*this.itemsMin*(f-1)*-1);if(this.left===g){return}b.extend(this,{pages:c,page:f,start:h,end:d,left:g});this._loadPage();this.list.stop(true).animate({"margin-left":g+"px"},e)},prev:function(){this._move(this.page-1)},next:function(){this._move(this.page+1)},afterLoad:function(c,d){var e=c.position==="bottom"?2:0;if(d.group.length<2){d.helpers.thumbs=false;return}if(!this.wrap){this._create(d)}if(c.margin!==false){d.margin[e]=Math.max(((this.height)+40),d.margin[e])}},beforeShow:function(c,d){if(this.items){this.items.removeClass("fancybox-thumb-active");this.current=this.list.find("a[data-index='"+d.index+"']").parent().addClass("fancybox-thumb-active")}},onUpdate:function(){if(!this.wrap){return}this.wrap.width(a.getViewport().w);this.view=this.list.parent().innerWidth();this.itemsMin=Math.floor(this.view/this.width);this.itemsMax=Math.ceil(this.view/this.width);this._move()},beforeClose:function(){if(this.wrap){this.wrap.stop(true).remove()}b.extend(this,{pages:0,page:0,start:0,end:0,count:0,items:null,left:null,wrap:null,list:null})}}}(jQuery));